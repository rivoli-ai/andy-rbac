@page "/roles/{Id:guid}"
@using Andy.Rbac.Web.Services
@inject RbacApiService ApiService
@inject NavigationManager Navigation

<PageTitle>@(_role?.Name ?? "Role") - Andy RBAC</PageTitle>

<div class="page-header">
    <div class="page-header-actions">
        <div>
            <div class="d-flex align-center gap-2 mb-3">
                <a href="/roles" class="btn btn-secondary btn-sm">Back to Roles</a>
            </div>
            <h1>@(_role?.Name ?? "Loading...")</h1>
            <p class="subtitle">@(_role?.Description ?? "Role details and permissions")</p>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(_error))
{
    <div class="card" style="background: rgba(220,53,69,0.1); border-color: var(--danger); margin-bottom: 1rem;">
        <p style="color: var(--danger); margin: 0;">@_error</p>
    </div>
}

@if (_loading)
{
    <div class="loading">
        <div class="spinner"></div>
    </div>
}
else if (_role != null)
{
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon primary">C</div>
            <div class="stat-content">
                <div class="stat-label">Code</div>
                <div class="stat-value" style="font-size: 1.25rem;"><code>@_role.Code</code></div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon info">A</div>
            <div class="stat-content">
                <div class="stat-label">Application</div>
                <div class="stat-value" style="font-size: 1.25rem;"><code>@(_role.ApplicationCode ?? "global")</code></div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon success">S</div>
            <div class="stat-content">
                <div class="stat-label">System Role</div>
                <div class="stat-value" style="font-size: 1.25rem;">@(_role.IsSystem ? "Yes" : "No")</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Role Information</h3>
        </div>
        <div class="form-group">
            <label class="form-label">Name</label>
            <p>@_role.Name</p>
        </div>
        @if (!string.IsNullOrEmpty(_role.Description))
        {
            <div class="form-group">
                <label class="form-label">Description</label>
                <p>@_role.Description</p>
            </div>
        }
    </div>
}

@code {
    [Parameter]
    public Guid Id { get; set; }

    private bool _loading = true;
    private string? _error;
    private RoleDto? _role;

    protected override async Task OnInitializedAsync()
    {
        await LoadRole();
    }

    private async Task LoadRole()
    {
        _loading = true;
        _error = null;
        try
        {
            var roles = await ApiService.GetRolesAsync(null);
            _role = roles.FirstOrDefault(r => r.Id == Id);

            if (_role == null)
            {
                _error = $"Role not found.";
            }
        }
        catch (Exception ex)
        {
            _error = $"Failed to load role: {ex.Message}";
        }
        finally
        {
            _loading = false;
        }
    }
}
